// संस्कृत-स्रोत: वाक्य-विच्छेदक (पार्सर) कंकाल
// शब्द-विभाजक पर आश्रित

आयात कण्ठि.शब्दविभाजक

गण अभिव्यक्ति_प्रकार {
  शून्य
  लिटरल_पूर्ण
  लिटरल_दशांश
  लिटरल_श्रृंखला
  नाम
  द्विक_क्रिया      // a + b, a - b, a * b, a / b
}

संरचना अभिव्यक्ति {
  प्रकार: अभिव्यक्ति_प्रकार
  वाम: वैकल्पिक<&अभिव्यक्ति>
  दक्षिण: वैकल्पिक<&अभिव्यक्ति>
  मान: वैकल्पिक<श्रृंखला>
}

गण कथन_प्रकार {
  अभिव्यक्ति_कथन
  मुद्रण_कथन       // लिख("...")
}

संरचना कथन {
  प्रकार: कथन_प्रकार
  अभि: वैकल्पिक<&अभिव्यक्ति>
}

संरचना कार्य_परिभाषा {
  नाम: श्रृंखला
  शरीर: सूची<कथन>
}

संरचना कार्यक्रम {
  कार्याणि: सूची<कार्य_परिभाषा>
}

संरचना पार्सर {
  धारा: अक्षर_धारा
  वर्तमान: टोकन
}

कार्य आरम्भ_पार्सर(पाठ: श्रृंखला): पार्सर {
  धा = आरम्भ_धारा(पाठ)
  प्रथम = टोकन_अगला(&धा)
  लौटय पार्सर{धारा: धा, वर्तमान: प्रथम}
}

कार्य अग्रगामी(प: &पार्सर): शून्य {
  प.वर्तमान = टोकन_अगला(&प.धारा)
}

कार्य अपेक्षित(प: &पार्सर, प्रकार: चिह्न): तर्क {
  यदि (प.वर्तमान.प्रकार == प्रकार) { अग्रगामी(प); लौटय सत्य }
  लौटय असत्य
}

कार्य पार्स_कार्य(प: &पार्सर): कार्य_परिभाषा {
  // कार्य मुख्य() { ... }
  // सरलीकृत: मानते हैं इनपुट सुव्यवस्थित है
  // TODO: पहचान और पैरामीटर पार्स करना (v0.2)
  शरीर: सूची<कथन> = []
  जबकि (प.वर्तमान.प्रकार != शब्द_समाप्त) {
    कथ = पार्स_कथन(प)
    जोड़ो(शरीर, कथ)
  }
  लौटय कार्य_परिभाषा{नाम: "मुख्य", शरीर: शरीर}
}

कार्य पार्स_कथन(प: &पार्सर): कथन {
  // मुद्रण: लिख("...") ;
  यदि (प.वर्तमान.प्रकार == परिचायक और प.वर्तमान.पाठ्य == "लिख") {
    अग्रगामी(प)
    अपेक्षित(प, चिह्न_खुला)
    अभि = पार्स_अभिव्यक्ति(प)
    अपेक्षित(प, चिह्न_बन्द)
    यदि (प.वर्तमान.प्रकार == विराम) { अग्रगामी(प) }
    लौटय कथन{प्रकार: मुद्रण_कथन, अभि: अभि}
  }
  // सामान्य अभिव्यक्ति-आधारित कथन
  अभि = पार्स_अभिव्यक्ति(प)
  यदि (प.वर्तमान.प्रकार == विराम) { अग्रगामी(प) }
  लौटय कथन{प्रकार: अभिव्यक्ति_कथन, अभि: अभि}
}

कार्य पार्स_अभिव्यक्ति(प: &पार्सर): &अभिव्यक्ति {
  वाम = पार्स_प्रधान(प)
  जबकि (प.वर्तमान.प्रकार == जोड़ या प.वर्तमान.प्रकार == घट या प.वर्तमान.प्रकार == गुण या प.वर्तमान.प्रकार == भाग) {
    क्र = प.वर्तमान
    अग्रगामी(प)
    दक्षिण = पार्स_प्रधान(प)
    सा = अभिव्यक्ति{प्रकार: द्विक_क्रिया, वाम: वाम, दक्षिण: दक्षिण, मान: रिक्त}
    वाम = &सा
  }
  लौटय वाम
}

कार्य पार्स_प्रधान(प: &पार्सर): &अभिव्यक्ति {
  ट = प.वर्तमान
  यदि (ट.प्रकार == पूर्णांक या ट.प्रकार == दशांश या ट.प्रकार == लेख्य) {
    अग्रगामी(प)
    ए = अभिव्यक्ति{प्रकार: (ट.प्रकार == पूर्णांक ? लिटरल_पूर्ण : (ट.प्रकार == दशांश ? लिटरल_दशांश : लिटरल_श्रृंखला)), वाम: रिक्त, दक्षिण: रिक्त, मान: ट.पाठ्य}
    लौटय &ए
  }
  यदि (ट.प्रकार == परिचायक) {
    अग्रगामी(प)
    ए = अभिव्यक्ति{प्रकार: नाम, वाम: रिक्त, दक्षिण: रिक्त, मान: ट.पाठ्य}
    लौटय &ए
  }
  यदि (ट.प्रकार == चिह्न_खुला) {
    अग्रगामी(प)
    भी = पार्स_अभिव्यक्ति(प)
    अपेक्षित(प, चिह्न_बन्द)
    लौटय भी
  }
  // त्रुटि स्थितिः अभी लिटरल शून्य
  ए = अभिव्यक्ति{प्रकार: शून्य, वाम: रिक्त, दक्षिण: रिक्त, मान: ""}
  लौटय &ए
}


